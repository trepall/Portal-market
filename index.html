<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portals Market</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            padding-bottom: 80px;
            transition: background 0.3s;
            min-height: 100vh;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .close-btn {
            font-size: 18px;
            color: #666;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .settings-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .settings-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .search-container {
            position: relative;
            width: 100%;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: white;
            font-size: 14px;
        }

        .search-input:focus {
            border-color: #4facfe;
            outline: none;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            cursor: pointer;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            position: relative;
            z-index: 10;
        }

        .filter {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            position: relative;
            user-select: none;
            transition: all 0.2s;
        }

        .filter:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .filter-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: rgba(42, 42, 42, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 10px;
            margin-top: 5px;
            min-width: 150px;
            max-width: 200px;
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .filter-option {
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .filter-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .filter-option.active {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
        }

        .price-range {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .price-inputs {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .price-input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 10px 12px;
            border-radius: 12px;
            width: 100%;
            font-size: 14px;
        }

        .price-input:focus {
            border-color: #4facfe;
            outline: none;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border: none;
            color: #fff;
            padding: 12px 15px;
            border-radius: 16px;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s;
            width: 100%;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(79, 172, 254, 0.3);
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(79, 172, 254, 0.4);
        }

        .products-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .product-card {
            border-radius: 16px;
            padding: 16px;
            position: relative;
            transition: transform 0.2s;
            background: linear-gradient(135deg, var(--card-color), rgba(42, 42, 42, 0.8));
            border: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: fadeIn 0.5s ease-in;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            overflow: hidden;
            backdrop-filter: blur(5px);
            cursor: pointer;
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--card-border);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .product-info {
            flex: 1;
        }

        .product-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .product-id {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            padding: 4px 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            display: inline-block;
            transition: background 0.2s;
        }

        .product-id:hover {
            background: rgba(0,0,0,0.5);
        }

        .product-price-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .product-price {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            padding: 6px 10px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .cart-btn {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            border: none;
            color: #fff;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            transition: all 0.2s;
        }

        .cart-btn:hover {
            transform: scale(1.1);
        }

        .cart-icon {
            width: 20px;
            height: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #ddd;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(42, 42, 42, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding: 12px 20px;
            display: flex;
            justify-content: space-around;
            z-index: 1000;
        }

        .nav-item {
            text-align: center;
            font-size: 10px;
            color: #ddd;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            flex: 1;
            transition: all 0.2s;
            padding: 5px;
            border-radius: 10px;
        }

        .nav-item.active {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .nav-market { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>'); }
        .nav-gifts { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/></svg>'); }
        .nav-wallet { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>'); }
        .nav-profile { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>'); }
        .nav-support { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>'); }

        .nav-item.active .nav-icon {
            filter: brightness(0) invert(1);
        }

        .nav-item:not(.active) .nav-icon {
            filter: brightness(0) invert(0.7);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
            flex-shrink: 0;
        }

        .profile-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.6);
        }

        .avatar-placeholder {
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .avatar-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .avatar-icon {
            width: 50px;
            height: 50px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .edit-pencil {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(79, 172, 254, 0.9);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            border: 2px solid white;
        }

        .profile-avatar:hover .edit-pencil {
            opacity: 1;
        }

        .profile-info {
            flex: 1;
            min-width: 0;
        }

        .profile-name-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .profile-name-container:hover {
            background: rgba(255,255,255,0.1);
        }

        .profile-name {
            font-size: 20px;
            font-weight: 600;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .edit-icon {
            width: 16px;
            height: 16px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.7;
        }

        .name-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 20px;
            font-weight: 600;
            width: 100%;
            padding: 5px 10px;
            border-radius: 8px;
            outline: none;
        }

        .name-input:focus {
            border-color: #4facfe;
        }

        .balance-section {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.2));
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .balance-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(79, 172, 254, 0.4);
        }

        .balance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .balance-title {
            font-size: 18px;
            color: #ddd;
        }

        .balance-amount {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .balance-currency {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            color: #fff;
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .balance-currency:hover {
            transform: scale(1.05);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.2));
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: #ddd;
            font-size: 16px;
        }

        .settings-section {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.2));
            border-radius: 20px;
            padding: 0;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background 0.2s;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .settings-item-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .settings-icon {
            width: 20px;
            height: 20px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .icon-settings { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>'); }
        .icon-language { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>'); }
        .icon-currency { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91 1.91.46 3.39 1.24 3.39 3.19 0 1.8-1.39 2.83-3.13 3.16z"/></svg>'); }
        .icon-support { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>'); }

        .settings-arrow {
            color: #ddd;
            font-size: 14px;
        }

        .total-volume {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.2));
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .total-volume:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .total-volume-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .total-volume-label {
            color: #ddd;
            font-size: 16px;
        }

        .requisites-card {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.2));
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .requisites-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .requisites-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            color: white;
            font-weight: 600;
        }

        .requisites-btn:hover {
            transform: translateY(-2px);
        }

        .deposit-screen, .withdraw-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            z-index: 2000;
            overflow-y: auto;
            padding-bottom: 80px;
        }

        .deposit-screen.active, .withdraw-screen.active {
            display: block;
        }

        .deposit-content, .withdraw-content {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }

        .deposit-header, .withdraw-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .deposit-back, .withdraw-back {
            font-size: 18px;
            color: #666;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .deposit-back:hover, .withdraw-back:hover {
            background: rgba(255,255,255,0.1);
        }

        .deposit-title, .withdraw-title {
            font-size: 24px;
            font-weight: 600;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .deposit-info {
            margin-top: 15px;
        }

        .requisites-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .requisites-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #4facfe;
        }

        .requisites-value {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 12px;
            border-radius: 8px;
            word-break: break-all;
            cursor: pointer;
            transition: background 0.2s;
        }

        .requisites-value:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        .withdraw-form {
            margin-top: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 12px 15px;
            border-radius: 12px;
            font-size: 16px;
        }

        .form-input:focus {
            border-color: #4facfe;
            outline: none;
        }

        .form-select {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 12px 15px;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
        }

        .submit-btn {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            border: none;
            color: #fff;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(79, 172, 254, 0.4);
        }

        .balance-currencies {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .balance-currency-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .balance-currency-amount {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .balance-currency-name {
            font-size: 14px;
            color: #ddd;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(42, 42, 42, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px 20px;
            max-width: 300px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease-out;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid #4CAF50;
        }

        .notification.error {
            border-left: 4px solid #f44336;
        }

        .notification.info {
            border-left: 4px solid #4facfe;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification-close {
            background: none;
            border: none;
            color: #ddd;
            font-size: 18px;
            cursor: pointer;
            margin-left: auto;
        }

        #settings-tab {
            display: none;
        }

        #settings-tab.active {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(42, 42, 42, 0.95);
            border-radius: 20px;
            padding: 25px;
            width: 320px;
            max-width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-option {
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 8px;
            transition: background 0.2s;
        }

        .modal-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .modal-option.active {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .modal-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .modal-save {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            color: white;
        }

        .letter-icon {
            font-size: 36px;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .gifts-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .gift-tab {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 14px;
            text-align: center;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s;
        }

        .gift-tab.active {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
        }

        .gift-tab:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .sub-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .sub-tab {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 12px;
            border-radius: 12px;
            font-size: 13px;
            text-align: center;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s;
        }

        .sub-tab.active {
            background: rgba(79, 172, 254, 0.3);
            border-color: rgba(79, 172, 254, 0.7);
        }

        .add-product-btn {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border: none;
            color: #fff;
            padding: 15px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(79, 172, 254, 0.3);
        }

        .add-product-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(79, 172, 254, 0.4);
        }

        .instruction-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .instruction-step {
            margin-bottom: 15px;
            padding-left: 20px;
            position: relative;
        }

        .instruction-step:before {
            content: '•';
            position: absolute;
            left: 0;
            color: #4facfe;
            font-size: 18px;
        }

        .product-form {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .action-btn.primary {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            color: white;
        }

        .action-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .product-image-preview {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            overflow: hidden;
            border: 2px dashed rgba(255, 255, 255, 0.2);
        }

        .product-image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .upload-placeholder {
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
        }

        .upload-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .product-form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 3000;
            overflow-y: auto;
            padding: 20px 0;
        }

        .product-form-modal.active {
            display: block;
        }

        .product-form-content {
            max-width: 400px;
            margin: 0 auto;
            background: rgba(42, 42, 42, 0.95);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .product-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .product-form-title {
            font-size: 24px;
            font-weight: 600;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .product-form-back {
            font-size: 18px;
            color: #666;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .product-form-back:hover {
            background: rgba(255,255,255,0.1);
        }

        .action-icon {
            width: 20px;
            height: 20px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .icon-remove {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>');
        }

        .icon-add-market {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>');
        }

        .icon-share {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>');
        }

        .cart-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .cart-item-price {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .cart-remove-btn {
            background: rgba(244, 67, 54, 0.8);
            border: none;
            color: #fff;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-total {
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
            font-weight: 600;
        }

        .buy-cart-btn {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            border: none;
            color: #fff;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            transition: all 0.2s;
        }

        .buy-cart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(79, 172, 254, 0.4);
        }

        .share-link-container {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .share-link-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #4facfe;
        }

        .share-link-value {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 12px;
            border-radius: 8px;
            word-break: break-all;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
        }

        .share-link-value:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        .support-categories {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .support-category {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 18px 20px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s;
        }

        .support-category:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .category-icon {
            font-size: 24px;
            margin-right: 15px;
            width: 40px;
            text-align: center;
        }

        .category-info {
            flex: 1;
        }

        .category-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .category-desc {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        .category-arrow {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.7);
        }

        .support-section {
            animation: fadeIn 0.3s ease-in;
        }

        .support-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }

        .support-back {
            font-size: 18px;
            color: #4facfe;
            cursor: pointer;
            margin-right: 15px;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .support-back:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .support-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .support-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            cursor: pointer;
        }

        .support-question {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            font-weight: 600;
        }

        .support-arrow {
            transition: transform 0.3s;
        }

        .support-item.active .support-arrow {
            transform: rotate(180deg);
        }

        .support-answer {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
        }

        .support-item.active .support-answer {
            padding: 0 20px 20px 20px;
            max-height: 500px;
        }

        .sync-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(42, 42, 42, 0.9);
            border-radius: 20px;
            padding: 10px 15px;
            font-size: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1000;
            backdrop-filter: blur(10px);
            display: none;
        }

        .sync-status.syncing {
            border-color: #4facfe;
            display: block;
        }

        .sync-status.success {
            border-color: #4CAF50;
            display: block;
        }

        .sync-status.error {
            border-color: #f44336;
            display: block;
        }

        .sync-btn {
            background: rgba(79, 172, 254, 0.2);
            border: 1px solid rgba(79, 172, 254, 0.5);
            color: #4facfe;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .sync-btn:hover {
            background: rgba(79, 172, 254, 0.3);
        }

        .sync-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .admin-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .admin-section {
            margin-bottom: 25px;
        }

        .admin-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #4facfe;
        }

        /* Стили для модального окна товара */
        .product-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .product-modal-content {
            background: rgba(42, 42, 42, 0.95);
            border-radius: 20px;
            padding: 25px;
            max-width: 500px;
            width: 100%;
            margin: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }

        .product-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .product-modal-title {
            font-size: 24px;
            font-weight: 600;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .product-modal-close {
            font-size: 18px;
            color: #666;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .product-modal-close:hover {
            background: rgba(255,255,255,0.1);
        }

        .product-modal-image {
            width: 100%;
            height: 250px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .product-modal-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .product-modal-details {
            margin-bottom: 20px;
        }

        .product-modal-price {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        .product-modal-description {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .product-modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .product-modal-btn {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .product-modal-buy {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            color: white;
        }

        .product-modal-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .product-modal-btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div id="sync-status" class="sync-status"></div>

    <div id="market-tab" class="tab-content active">
        <div class="container">
            <div class="header">
                <h1 id="market-title">Фильтры</h1>
                <div class="close-btn">×</div>
            </div>

            <div class="search-container">
                <input type="text" id="product-search" class="search-input" placeholder="Поиск по ID товара...">
                <div class="search-icon" onclick="performSearch()">🔍</div>
            </div>

            <div class="filters">
                <div class="filter" id="model-filter">
                    <span class="filter-text" id="model-filter-text">Модель</span> <span>▼</span>
                    <div class="filter-dropdown" id="model-dropdown">
                        <div class="filter-option active" data-value="all">Все модели</div>
                    </div>
                </div>
                <div class="filter" id="currency-filter">
                    <span class="filter-text" id="currency-filter-text">Валюта</span> <span>▼</span>
                    <div class="filter-dropdown" id="currency-dropdown">
                        <div class="filter-option active" data-value="all">Все валюты</div>
                        <div class="filter-option" data-value="TON">TON</div>
                        <div class="filter-option" data-value="RUB">RUB</div>
                        <div class="filter-option" data-value="USD">USD</div>
                        <div class="filter-option" data-value="EUR">EUR</div>
                        <div class="filter-option" data-value="STARS">STARS</div>
                    </div>
                </div>
            </div>

            <div class="price-range">
                <div class="price-inputs">
                    <input type="text" class="price-input" id="price-min" placeholder="От 100" value="100">
                    <input type="text" class="price-input" id="price-max" placeholder="До 10000" value="10000">
                </div>
            </div>

            <button class="refresh-btn" onclick="refreshCatalog()">🔄 <span id="refresh-text">Обновить</span></button>

            <div class="products-list" id="products-list">
                <!-- Товары загружаются здесь -->
            </div>

            <div class="loading" id="loading" style="display: none;">⏳ <span id="loading-text">Загрузка...</span></div>
        </div>
    </div>

    <div id="gifts-tab" class="tab-content">
        <div class="container">
            <div class="header">
                <h1 id="gifts-title">Подарки</h1>
                <div class="close-btn">×</div>
            </div>

            <div class="gifts-tabs">
                <div class="gift-tab active" onclick="showGiftTab('my-gifts')" id="my-gifts-tab">Мои подарки</div>
                <div class="gift-tab" onclick="showGiftTab('cart')" id="cart-tab">Корзина</div>
            </div>

            <div id="my-gifts-content" class="gift-tab-content">
                <div class="sub-tabs">
                    <div class="sub-tab active" onclick="showSubTab('listed')" id="listed-tab">Выставленные</div>
                    <div class="sub-tab" onclick="showSubTab('unlisted')" id="unlisted-tab">Не выставленные</div>
                </div>

                <div id="listed-gifts" class="sub-tab-content">
                    <div class="products-list" id="listed-products-list">
                        <!-- Выставленные подарки -->
                    </div>
                    <div style="text-align: center; padding: 40px; color: #ddd; background: rgba(255, 255, 255, 0.1); border-radius: 20px; backdrop-filter: blur(10px); display: none;" id="no-listed-gifts">
                        <h3>Нет выставленных подарков</h3>
                    </div>
                </div>

                <div id="unlisted-gifts" class="sub-tab-content" style="display: none;">
                    <div class="products-list" id="unlisted-products-list">
                        <!-- Не выставленные подарки -->
                    </div>
                    <div style="text-align: center; padding: 40px; color: #ddd; background: rgba(255, 255, 255, 0.1); border-radius: 20px; backdrop-filter: blur(10px); display: none;" id="no-unlisted-gifts">
                        <h3>Нет не выставленных подарков</h3>
                    </div>
                </div>

                <button class="add-product-btn" onclick="openProductFormModal()">+ Добавить товар</button>
            </div>

            <div id="cart-content" class="gift-tab-content" style="display: none;">
                <div id="cart-items-container">
                    <!-- Товары в корзине -->
                </div>
                <div id="empty-cart" style="text-align: center; padding: 40px; color: #ddd; background: rgba(255, 255, 255, 0.1); border-radius: 20px; backdrop-filter: blur(10px);">
                    <h3>Корзина пуста</h3>
                </div>
                <div id="cart-total-container" style="display: none;">
                    <div class="cart-total">
                        Общая сумма: <span id="cart-total-amount">0</span> TON
                    </div>
                    <button class="buy-cart-btn" onclick="buyCartItems()">Купить все</button>
                </div>
            </div>
        </div>
    </div>

    <div id="requisites-tab" class="tab-content">
        <div class="container">
            <div class="header">
                <h1 id="requisites-title">Реквизиты</h1>
                <div class="close-btn">×</div>
            </div>
            
            <div class="requisites-card">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span id="balance-label">Баланс:</span>
                    <span><strong id="balance-ton">0 TON</strong></span>
                </div>
                
                <div class="balance-currencies">
                    <div class="balance-currency-item">
                        <div class="balance-currency-amount" id="balance-rub">0 ₽</div>
                        <div class="balance-currency-name">RUB</div>
                    </div>
                    <div class="balance-currency-item">
                        <div class="balance-currency-amount" id="balance-usd">0 $</div>
                        <div class="balance-currency-name">USD</div>
                    </div>
                    <div class="balance-currency-item">
                        <div class="balance-currency-amount" id="balance-eur">0 €</div>
                        <div class="balance-currency-name">EUR</div>
                    </div>
                    <div class="balance-currency-item">
                        <div class="balance-currency-amount" id="balance-stars">0 ⭐</div>
                        <div class="balance-currency-name">STARS</div>
                    </div>
                </div>
                
                <div class="requisites-actions">
                    <button class="requisites-btn" onclick="openDepositScreen()"><span id="deposit-text">Пополнить</span></button>
                    <button class="requisites-btn" onclick="openWithdrawScreen()"><span id="withdraw-text">Вывести</span></button>
                </div>
            </div>
            
            <div class="requisites-card">
                <h3 style="margin-bottom: 15px;" id="history-title">История операций</h3>
                <div style="text-align: center; color: #ddd; padding: 20px;">
                    <span id="no-operations-text">Пока нет операций</span>
                </div>
            </div>
        </div>
    </div>

    <div id="profile-tab" class="tab-content">
        <div class="container">
            <div class="header">
                <button class="settings-btn" onclick="showTab('settings-tab')">
                    <div class="settings-icon icon-settings"></div>
                </button>
                <h1 id="profile-title">Профиль</h1>
                <div class="close-btn">×</div>
            </div>

            <div class="profile-header">
                <div class="profile-avatar" onclick="document.getElementById('avatar-upload').click()">
                    <div class="avatar-placeholder">
                        <div class="avatar-icon" id="avatar-icon"></div>
                        <img id="avatar-image" class="avatar-image" style="display: none;">
                    </div>
                    <div class="edit-pencil">
                        <div class="edit-pencil-icon"></div>
                    </div>
                </div>
                <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                <div class="profile-info">
                    <div class="profile-name-container" onclick="editName()">
                        <div class="profile-name" id="profile-name-text">Пользователь</div>
                        <div class="edit-icon"></div>
                        <input type="text" class="name-input" id="profile-name-input" style="display: none;" maxlength="20">
                    </div>
                </div>
            </div>

            <div class="balance-section">
                <div class="balance-header">
                    <div class="balance-title" id="balance-title-text">Баланс</div>
                    <div class="balance-currency" onclick="toggleCurrency()">₽</div>
                </div>
                <div class="balance-amount" id="balance-amount">0.00</div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="gifts-count">0</div>
                    <div class="stat-label" id="gifts-count-text">Подарков</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="sold-count">0</div>
                    <div class="stat-label" id="sold-text">Продано</div>
                </div>
            </div>

            <div class="total-volume">
                <div class="total-volume-value" id="total-volume">0 ₽</div>
                <div class="total-volume-label" id="total-volume-text">Общий объем торгов</div>
            </div>
        </div>
    </div>

    <div id="settings-tab" class="tab-content">
        <div class="container">
            <div class="header">
                <h1 id="settings-title">Настройки</h1>
                <div class="close-btn" onclick="showTab('profile-tab')">×</div>
            </div>

            <div class="settings-section">
                <div class="settings-item" onclick="openLanguageModal()">
                    <div class="settings-item-content">
                        <div class="settings-icon icon-language"></div>
                        <div id="language-text">Язык</div>
                    </div>
                    <div class="settings-arrow" id="current-language">Русский ›</div>
                </div>
                <div class="settings-item" onclick="openCurrencyModal()">
                    <div class="settings-item-content">
                        <div class="settings-icon icon-currency"></div>
                        <div id="currency-text">Валюта</div>
                    </div>
                    <div class="settings-arrow" id="current-currency">RUB ›</div>
                </div>
                <div class="settings-item" onclick="window.open('https://t.me/MarketSuportGift', '_blank')">
                    <div class="settings-item-content">
                        <div class="settings-icon icon-support"></div>
                        <div id="support-text">Поддержка</div>
                    </div>
                    <div class="settings-arrow">›</div>
                </div>
            </div>

            <div class="admin-panel" id="admin-panel" style="display: none;">
                <div class="admin-title">Администрирование базы знаний</div>
                
                <div class="admin-section">
                    <div style="margin-bottom: 15px;">
                        <strong>Статус базы знаний:</strong>
                        <span id="db-status">Не подключено</span>
                        <button class="sync-btn" onclick="testConnection()">Проверить подключение</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>FAQ записей:</strong>
                        <span id="faq-count">0</span>
                        <button class="sync-btn" onclick="syncFAQ()">Синхронизировать FAQ</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>Категории поддержки:</strong>
                        <span id="categories-count">0</span>
                        <button class="sync-btn" onclick="syncCategories()">Синхронизировать категории</button>
                    </div>
                </div>

                <div class="admin-section">
                    <div class="admin-title">Добавить новый FAQ</div>
                    <div class="form-group">
                        <input type="text" class="form-input" id="new-question" placeholder="Вопрос">
                    </div>
                    <div class="form-group">
                        <textarea class="form-input" id="new-answer" placeholder="Ответ" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-input" id="new-category" placeholder="Категория">
                    </div>
                    <button class="submit-btn" onclick="addNewFAQ()">Добавить FAQ</button>
                </div>
            </div>
        </div>
    </div>

    <div id="support-tab" class="tab-content">
        <div class="container">
            <div class="header">
                <h1>База знаний</h1>
                <div class="close-btn">×</div>
            </div>

            <div class="support-categories">
                <div class="support-category" onclick="showSupportSection('faq')">
                    <div class="category-icon">❓</div>
                    <div class="category-info">
                        <div class="category-title">Частые вопросы</div>
                        <div class="category-desc">Ответы на популярные вопросы</div>
                    </div>
                    <div class="category-arrow">›</div>
                </div>

                <div class="support-category" onclick="window.open('https://t.me/MarketSuportGift', '_blank')">
                    <div class="category-icon">💬</div>
                    <div class="category-info">
                        <div class="category-title">Написать в поддержку</div>
                        <div class="category-desc">Живая помощь в Telegram</div>
                    </div>
                    <div class="category-arrow">›</div>
                </div>
            </div>

            <div id="faq-section" class="support-section" style="display: none;">
                <div class="support-header">
                    <div class="support-back" onclick="hideSupportSection()">← Назад</div>
                    <h2>Частые вопросы</h2>
                </div>

                <div class="support-content" id="faq-content">
                    <!-- FAQ загружается из базы -->
                </div>
            </div>
        </div>
    </div>

    <div id="deposit-screen" class="deposit-screen">
        <div class="deposit-content">
            <div class="deposit-header">
                <div class="deposit-back" onclick="closeDepositScreen()">←</div>
                <h1 class="deposit-title" id="deposit-title-text">Пополнение баланса</h1>
                <div style="width: 30px;"></div>
            </div>

            <div class="requisites-card">
                <p style="margin-bottom: 15px; text-align: center;" id="deposit-instruction-text">Чтобы пополнить баланс отправьте нужную сумму на реквизиты ниже 👇</p>
                
                <div class="deposit-info">
                    <div class="requisites-item">
                        <div class="requisites-title">TonKeeper</div>
                        <div class="requisites-value" onclick="copyToClipboard('UQA8t_PXSXu1mfNdwnLVS7BAv4WV6d-L8A2BTn7LA8XL2D-G')">
                            UQA8t_PXSXu1mfNdwnLVS7BAv4WV6d-L8A2BTn7LA8XL2D-G
                        </div>
                    </div>
                    
                    <div class="requisites-item">
                        <div class="requisites-title">Юмани</div>
                        <div class="requisites-value" onclick="copyToClipboard('89202555790')">
                            89202555790
                        </div>
                    </div>
                    
                    <div style="background: rgba(79, 172, 254, 0.2); padding: 15px; border-radius: 12px; margin-top: 15px; text-align: center;">
                        <strong id="deposit-wait-text">После, ожидайте 10-15 минут!</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="withdraw-screen" class="withdraw-screen">
        <div class="withdraw-content">
            <div class="withdraw-header">
                <div class="withdraw-back" onclick="closeWithdrawScreen()">←</div>
                <h1 class="withdraw-title" id="withdraw-title-text">Вывод средств</h1>
                <div style="width: 30px;"></div>
            </div>

            <div class="requisites-card">
                <div class="withdraw-form">
                    <div class="form-group">
                        <label class="form-label" id="withdraw-currency-label">Валюта</label>
                        <select class="form-select" id="withdraw-currency">
                            <option value="TON">TON</option>
                            <option value="RUB">RUB</option>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="STARS">STARS</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" id="withdraw-amount-label">Сумма</label>
                        <input type="number" class="form-input" id="withdraw-amount" placeholder="Введите сумму" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" id="withdraw-requisites-label">Реквизиты</label>
                        <input type="text" class="form-input" id="withdraw-requisites" placeholder="Введите реквизиты для вывода">
                    </div>
                    
                    <button class="submit-btn" onclick="processWithdraw()"><span id="withdraw-button-text">Вывести</span></button>
                </div>
            </div>
        </div>
    </div>

    <div id="product-form-modal" class="product-form-modal">
        <div class="product-form-content">
            <div class="product-form-header">
                <div class="product-form-back" onclick="closeProductFormModal()">←</div>
                <h1 class="product-form-title">Добавление товара</h1>
                <div style="width: 30px;"></div>
            </div>

            <div class="instruction-card">
                <h3 style="margin-bottom: 15px; text-align: center;">Инструкция</h3>
                <div class="instruction-step">
                    Чтобы выложить товар на продажу передайте его нашей Тех. Поддержке (Realyer) 
                    <a href="https://t.me/MarketSuportGift" target="_blank" style="color: #4facfe; text-decoration: none;">@MarketSuportGift</a>
                </div>
                <div class="instruction-step">
                    После передачи заполните анкету товара ниже
                </div>
            </div>

            <div class="product-form">
                <div class="form-group">
                    <label class="form-label">Тип товара</label>
                    <select class="form-select" id="product-type">
                        <option value="gift">Подарок</option>
                        <option value="crypto">Криптовалюта</option>
                        <option value="other">Другое</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Название товара</label>
                    <input type="text" class="form-input" id="product-name" placeholder="Введите название товара">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ссылка на товар <span style="color: #ff6b6b;">*</span></label>
                    <input type="text" class="form-input" id="product-link" placeholder="https://example.com/product">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Фото товара (необязательно)</label>
                    <div class="product-image-preview" onclick="document.getElementById('product-image-upload').click()">
                        <div class="upload-placeholder">
                            <div class="upload-icon">📷</div>
                            <div>Нажмите для загрузки фото</div>
                        </div>
                        <img id="product-image-preview" style="display: none;">
                    </div>
                    <input type="file" id="product-image-upload" accept="image/*" style="display: none;">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Цена</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" class="form-input" id="product-price" placeholder="0.00" min="0" step="0.01" style="flex: 2;">
                        <select class="form-select" id="product-currency" style="flex: 1;">
                            <option value="TON">TON</option>
                            <option value="RUB">RUB</option>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="STARS">STARS</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button class="action-btn secondary" onclick="closeProductFormModal()">Отмена</button>
                    <button class="action-btn primary" onclick="createProduct()">Создать товар</button>
                </div>
            </div>
        </div>
    </div>

    <div id="language-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="language-modal-title">Выберите язык</div>
            <div class="modal-option active" data-value="ru">Русский</div>
            <div class="modal-option" data-value="en">English</div>
            <div class="modal-actions">
                <button class="modal-btn modal-cancel" onclick="closeModal('language-modal')"><span id="cancel-text">Отмена</span></button>
                <button class="modal-btn modal-save" onclick="saveLanguage()"><span id="save-text">Сохранить</span></button>
            </div>
        </div>
    </div>

    <div id="currency-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="currency-modal-title">Выберите валюту</div>
            <div class="modal-option active" data-value="RUB">RUB - Российский рубль</div>
            <div class="modal-option" data-value="USD">USD - Доллар США</div>
            <div class="modal-option" data-value="EUR">EUR - Евро</div>
            <div class="modal-option" data-value="TON">TON - Toncoin</div>
            <div class="modal-option" data-value="STARS">STARS - Stars</div>
            <div class="modal-actions">
                <button class="modal-btn modal-cancel" onclick="closeModal('currency-modal')"><span id="cancel-text-2">Отмена</span></button>
                <button class="modal-btn modal-save" onclick="saveCurrency()"><span id="save-text-2">Сохранить</span></button>
            </div>
        </div>
    </div>

    <div id="notification-container"></div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="showTab('market-tab')">
            <div class="nav-icon nav-market"></div>
            <div id="nav-market-text">Маркет</div>
        </div>
        <div class="nav-item" onclick="showTab('gifts-tab')">
            <div class="nav-icon nav-gifts"></div>
            <div id="nav-gifts-text">Подарки</div>
        </div>
        <div class="nav-item" onclick="showTab('requisites-tab')">
            <div class="nav-icon nav-wallet"></div>
            <div id="nav-wallet-text">Реквизиты</div>
        </div>
        <div class="nav-item" onclick="showTab('support-tab')">
            <div class="nav-icon nav-support"></div>
            <div id="nav-support-text">Поддержка</div>
        </div>
        <div class="nav-item" onclick="showTab('profile-tab')">
            <div class="nav-icon nav-profile"></div>
            <div id="nav-profile-text">Профиль</div>
        </div>
    </div>

    <script>
        // ГЛОБАЛЬНАЯ БАЗА ТОВАРОВ - работает везде и всегда
        const globalProductsDatabase = {
            // Статические товары
            "signet_ring_001": { 
                id: "signet_ring_001",
                name: "Signet Ring", 
                priceTON: "15.2", 
                color: "rgba(79, 172, 254, 0.3)", 
                border: "rgba(79, 172, 254, 0.7)", 
                icon: "R",
                type: "gift"
            },
            "skull_flower_002": { 
                id: "skull_flower_002",
                name: "Skull Flower", 
                priceTON: "8.8", 
                color: "rgba(156, 39, 176, 0.3)", 
                border: "rgba(156, 39, 176, 0.7)", 
                icon: "S",
                type: "gift"
            },
            "snow_mittens_003": { 
                id: "snow_mittens_003",
                name: "Snow Mittens", 
                priceTON: "3.5", 
                color: "rgba(33, 150, 243, 0.3)", 
                border: "rgba(33, 150, 243, 0.7)", 
                icon: "M",
                type: "gift"
            },
            "spiced_wine_004": { 
                id: "spiced_wine_004",
                name: "Spiced Wine", 
                priceTON: "12.1", 
                color: "rgba(244, 67, 54, 0.3)", 
                border: "rgba(244, 67, 54, 0.7)", 
                icon: "W",
                type: "gift"
            },
            "spy_agaric_005": { 
                id: "spy_agaric_005",
                name: "Spy Agaric", 
                priceTON: "7.5", 
                color: "rgba(76, 175, 80, 0.3)", 
                border: "rgba(76, 175, 80, 0.7)", 
                icon: "F",
                type: "gift"
            },
            
            // Демо-товары для тестирования
            "demo_gift_001": {
                id: "demo_gift_001",
                name: "Золотой подарок",
                priceTON: "25.0",
                color: "rgba(255, 193, 7, 0.3)",
                border: "rgba(255, 193, 7, 0.7)",
                icon: "🎁",
                type: "gift"
            },
            "demo_crypto_002": {
                id: "demo_crypto_002",
                name: "Bitcoin",
                priceTON: "45.0",
                color: "rgba(255, 152, 0, 0.3)",
                border: "rgba(255, 152, 0, 0.7)",
                icon: "₿",
                type: "crypto"
            }
        };

        // УНИВЕРСАЛЬНАЯ ФУНКЦИЯ ПОИСКА ТОВАРА
        function universalProductSearch(productId) {
            console.log('🌐 Универсальный поиск товара:', productId);
            
            // 1. Ищем в глобальной БД (всегда работает)
            let product = globalProductsDatabase[productId];
            
            if (product) {
                console.log('✅ Товар найден в глобальной БД:', product.name);
                return product;
            }
            
            // 2. Ищем в реальных товарах
            product = realGifts.find(p => p.id === productId);
            if (product) {
                console.log('✅ Товар найден в реальных товарах:', product.name);
                // Добавляем в глобальную БД для будущего использования
                globalProductsDatabase[productId] = product;
                return product;
            }
            
            // 3. Ищем в пользовательских товарах
            let userProduct = userGifts.listed.find(g => g.id === productId) || 
                            userGifts.unlisted.find(g => g.id === productId);
            if (userProduct) {
                console.log('✅ Товар найден в пользовательских подарках:', userProduct.name);
                // Добавляем в глобальную БД
                globalProductsDatabase[productId] = userProduct;
                return userProduct;
            }
            
            // 4. Если не нашли - создаем демо-товар
            console.log('🆕 Создаем демо-товар для ID:', productId);
            product = createDemoProduct(productId);
            globalProductsDatabase[productId] = product;
            
            return product;
        }

        // ФУНКЦИЯ СОЗДАНИЯ ДЕМО-ТОВАРА
        function createDemoProduct(productId) {
            const demoProducts = [
                { name: "Эксклюзивный подарок", priceTON: "20.0", icon: "🎁", type: "gift" },
                { name: "Цифровой актив", priceTON: "35.0", icon: "💎", type: "crypto" },
                { name: "Коллекционный предмет", priceTON: "15.0", icon: "🏆", type: "other" },
                { name: "Редкий артефакт", priceTON: "28.0", icon: "⚡", type: "gift" },
                { name: "NFT токен", priceTON: "42.0", icon: "🖼️", type: "crypto" }
            ];
            
            const randomDemo = demoProducts[Math.floor(Math.random() * demoProducts.length)];
            const colors = [
                "rgba(79, 172, 254, 0.3)", "rgba(156, 39, 176, 0.3)", "rgba(33, 150, 243, 0.3)",
                "rgba(244, 67, 54, 0.3)", "rgba(76, 175, 80, 0.3)", "rgba(255, 193, 7, 0.3)"
            ];
            const borders = [
                "rgba(79, 172, 254, 0.7)", "rgba(156, 39, 176, 0.7)", "rgba(33, 150, 243, 0.7)",
                "rgba(244, 67, 54, 0.7)", "rgba(76, 175, 80, 0.7)", "rgba(255, 193, 7, 0.7)"
            ];
            
            const colorIndex = Math.floor(Math.random() * colors.length);
            
            return {
                id: productId,
                name: randomDemo.name,
                priceTON: randomDemo.priceTON,
                icon: randomDemo.icon,
                type: randomDemo.type,
                color: colors[colorIndex],
                border: borders[colorIndex],
                isDemo: true
            };
        }

        // ОБНОВЛЕННАЯ ФУНКЦИЯ ПОИСКА И ПОКАЗА ТОВАРА
        function searchAndShowProductDirect(productId) {
            console.log('🎯 Универсальный поиск товара:', productId);
            
            const product = universalProductSearch(productId);
            
            if (product) {
                console.log('✅ Товар найден/создан:', product.name);
                
                // УБИРАЕМ УВЕДОМЛЕНИЕ О ДЕМО-ТОВАРЕ
                // if (product.isDemo) {
                //     showNotification('Это демо-товар. В реальной системе здесь был бы реальный товар', 'info', 4000);
                // }
                
                const currency = currencies[Math.floor(Math.random() * currencies.length)];
                
                // Проверяем, пользовательский ли это товар
                const isUserProduct = userGifts.listed.some(g => g.id === productId) || 
                                    userGifts.unlisted.some(g => g.id === productId);
                
                if (isUserProduct) {
                    const isListed = userGifts.listed.some(g => g.id === productId);
                    showUserProductModal(product, isListed);
                } else {
                    showProductModal(product, currency);
                }
            } else {
                console.log('❌ Не удалось найти или создать товар');
                showNotification('Товар не найден', 'error', 3000);
            }
        }

        // ОБНОВЛЕННАЯ ФУНКЦИЯ ОБРАБОТКИ ХЭША
        function handleHashChange() {
            const hash = window.location.hash;
            console.log('📍 Обрабатываем хэш:', hash);
            
            if (hash && hash.startsWith('#product=')) {
                const productId = hash.replace('#product=', '');
                console.log('🎯 Загружаем товар из ссылки:', productId);
                searchAndShowProductDirect(productId);
            }
        }

        // ОБНОВЛЕННАЯ ФУНКЦИЯ СОЗДАНИЯ ТОВАРА
        function createProduct() {
            const type = document.getElementById('product-type').value;
            const name = document.getElementById('product-name').value.trim();
            const link = document.getElementById('product-link').value.trim();
            const price = parseFloat(document.getElementById('product-price').value);
            const currency = document.getElementById('product-currency').value;
            
            // Получаем изображение из предпросмотра
            const imagePreview = document.getElementById('product-image-preview');
            const image = imagePreview.style.display !== 'none' ? imagePreview.src : null;
            
            if (!name) {
                showNotification('Введите название товара', 'error', 3000);
                return;
            }
            
            if (!link) {
                showNotification('Введите ссылку на товар', 'error', 3000);
                return;
            }
            
            if (!price || price <= 0) {
                showNotification('Введите корректную цену', 'error', 3000);
                return;
            }
            
            const productId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            const newProduct = {
                id: productId,
                type: type,
                name: name,
                link: link,
                price: price.toFixed(2),
                currency: currency,
                image: image,
                color: "rgba(79, 172, 254, 0.3)",
                border: "rgba(79, 172, 254, 0.7)",
                date: new Date().toISOString(),
                seller: userName
            };
            
            // ДОБАВЛЯЕМ В ГЛОБАЛЬНУЮ БАЗУ ДАННЫХ
            globalProductsDatabase[productId] = newProduct;
            
            // И в локальные данные пользователя
            userGifts.unlisted.push(newProduct);
            
            refreshUserGifts();
            saveToDatabase();
            
            closeProductFormModal();
            
            // Показываем ссылку на товар
            const productUrl = `${window.location.origin}${window.location.pathname}#product=${productId}`;
            showNotification(`Товар создан! Ссылка: ${productUrl}`, 'success', 5000);
        }

        // ОРИГИНАЛЬНЫЙ КОД
        const realGifts = [
            { 
                id: "signet_ring_001",
                name: "Signet Ring", 
                priceTON: "15.2", 
                color: "rgba(79, 172, 254, 0.3)", 
                border: "rgba(79, 172, 254, 0.7)", 
                icon: "R" 
            },
            { 
                id: "skull_flower_002",
                name: "Skull Flower", 
                priceTON: "8.8", 
                color: "rgba(156, 39, 176, 0.3)", 
                border: "rgba(156, 39, 176, 0.7)", 
                icon: "S" 
            },
            { 
                id: "snow_mittens_003",
                name: "Snow Mittens", 
                priceTON: "3.5", 
                color: "rgba(33, 150, 243, 0.3)", 
                border: "rgba(33, 150, 243, 0.7)", 
                icon: "M" 
            },
            { 
                id: "spiced_wine_004",
                name: "Spiced Wine", 
                priceTON: "12.1", 
                color: "rgba(244, 67, 54, 0.3)", 
                border: "rgba(244, 67, 54, 0.7)", 
                icon: "W" 
            },
            { 
                id: "spy_agaric_005",
                name: "Spy Agaric", 
                priceTON: "7.5", 
                color: "rgba(76, 175, 80, 0.3)", 
                border: "rgba(76, 175, 80, 0.7)", 
                icon: "F" 
            },
            { 
                id: "star_notepad_006",
                name: "Star Notepad", 
                priceTON: "4.8", 
                color: "rgba(255, 235, 59, 0.3)", 
                border: "rgba(255, 235, 59, 0.7)", 
                icon: "N" 
            },
            { 
                id: "swiss_watch_007",
                name: "Swiss Watch", 
                priceTON: "25.5", 
                color: "rgba(158, 158, 158, 0.3)", 
                border: "rgba(158, 158, 158, 0.7)", 
                icon: "T" 
            },
            { 
                id: "trapped_heart_008",
                name: "Trapped Heart", 
                priceTON: "18.9", 
                color: "rgba(233, 30, 99, 0.3)", 
                border: "rgba(233, 30, 99, 0.7)", 
                icon: "H" 
            },
            { 
                id: "vintage_cigar_009",
                name: "Vintage Cigar", 
                priceTON: "22.8", 
                color: "rgba(121, 85, 72, 0.3)", 
                border: "rgba(121, 85, 72, 0.7)", 
                icon: "C" 
            },
            { 
                id: "voodoo_doll_010",
                name: "Voodoo Doll", 
                priceTON: "14.1", 
                color: "rgba(103, 58, 183, 0.3)", 
                border: "rgba(103, 58, 183, 0.7)", 
                icon: "D" 
            },
            { 
                id: "witch_hat_011",
                name: "Witch Hat", 
                priceTON: "9.7", 
                color: "rgba(63, 81, 181, 0.3)", 
                border: "rgba(63, 81, 181, 0.7)", 
                icon: "W" 
            },
            { 
                id: "lunar_snake_012",
                name: "Lunar Snake", 
                priceTON: "16.4", 
                color: "rgba(0, 150, 136, 0.3)", 
                border: "rgba(0, 150, 136, 0.7)", 
                icon: "L" 
            },
            { 
                id: "mad_pumpkin_013",
                name: "Mad Pumpkin", 
                priceTON: "6.3", 
                color: "rgba(255, 152, 0, 0.3)", 
                border: "rgba(255, 152, 0, 0.7)", 
                icon: "P" 
            },
            { 
                id: "magic_potion_014",
                name: "Magic Potion", 
                priceTON: "28.6", 
                color: "rgba(233, 30, 99, 0.3)", 
                border: "rgba(233, 30, 99, 0.7)", 
                icon: "P" 
            },
            { 
                id: "mini_oscar_015",
                name: "Mini Oscar", 
                priceTON: "35.2", 
                color: "rgba(255, 193, 7, 0.3)", 
                border: "rgba(255, 193, 7, 0.7)", 
                icon: "O" 
            }
        ];

        const currencies = [
            { symbol: "TON", rate: 1 },
            { symbol: "RUB", rate: 185 },
            { symbol: "USD", rate: 2.1 },
            { symbol: "EUR", rate: 1.9 },
            { symbol: "STARS", rate: 120 }
        ];

        const sellers = ["trepal_fertyya", "xander_zolt", "kryton_n7", "zephyr_vortex", "orion_stark", "nova_spectre", "quantum_flux", "cypher_nexus", "astra_void"];

        const translations = {
            ru: {
                marketTitle: "Фильтры",
                modelFilter: "Модель",
                currencyFilter: "Валюта",
                refresh: "Обновить",
                loading: "Загрузка...",
                giftsTitle: "Подарки",
                noGifts: "У вас пока нет подарков",
                requisitesTitle: "Реквизиты",
                balanceLabel: "Баланс:",
                deposit: "Пополнить",
                withdraw: "Вывести",
                historyTitle: "История операций",
                noOperations: "Пока нет операций",
                profileTitle: "Профиль",
                balanceTitle: "Баланс",
                giftsCount: "Подарков",
                sold: "Продано",
                totalVolume: "Общий объем торгов",
                settingsTitle: "Настройки",
                language: "Язык",
                currency: "Валюта",
                support: "Поддержка",
                depositTitle: "Пополнение баланса",
                depositInstruction: "Чтобы пополнить баланс отправьте нужную сумму на реквизиты ниже 👇",
                depositWait: "После, ожидайте 10-15 минут!",
                withdrawTitle: "Вывод средств",
                withdrawCurrency: "Валюта",
                withdrawAmount: "Сумма",
                withdrawRequisites: "Реквизиты",
                withdrawButton: "Вывести",
                languageModalTitle: "Выберите язык",
                currencyModalTitle: "Выберите валюту",
                cancel: "Отмена",
                save: "Сохранить",
                navMarket: "Маркет",
                navGifts: "Подарки",
                navWallet: "Реквизиты",
                navProfile: "Профиль",
                navSupport: "Поддержка",
                allModels: "Все модели",
                allCurrencies: "Все валюты",
                buy: "Купить",
                close: "Закрыть",
                seller: "Продавец",
                addedToCart: "Добавлено в корзину:",
                purchaseSuccess: "Покупка успешна! Вы приобрели",
                insufficientFunds: "Недостаточно средств",
                nameChanged: "Имя успешно изменено!",
                copied: "Скопировано в буфер обмена!",
                copyError: "Ошибка копирования",
                withdrawRequest: "Заявка на вывод принята! Ожидайте обработки.",
                enterAmount: "Введите корректную сумму",
                enterRequisites: "Введите реквизиты для вывода",
                shareLink: "Поделиться ссылкой",
                shareProduct: "Поделиться товаром",
                productSold: "Товар продан!",
                sellerNotification: "Ваш товар купили!",
                sellerBalanceUpdated: "Баланс пополнен"
            },
            en: {
                marketTitle: "Filters",
                modelFilter: "Model",
                currencyFilter: "Currency",
                refresh: "Refresh",
                loading: "Loading...",
                giftsTitle: "Gifts",
                noGifts: "You have no gifts yet",
                requisitesTitle: "Requisites",
                balanceLabel: "Balance:",
                deposit: "Deposit",
                withdraw: "Withdraw",
                historyTitle: "Transaction History",
                noOperations: "No transactions yet",
                profileTitle: "Profile",
                balanceTitle: "Balance",
                giftsCount: "Gifts",
                sold: "Sold",
                totalVolume: "Total trading volume",
                settingsTitle: "Settings",
                language: "Language",
                currency: "Currency",
                support: "Support",
                depositTitle: "Deposit Funds",
                depositInstruction: "To deposit funds, send the required amount to the details below 👇",
                depositWait: "After that, wait 10-15 minutes!",
                withdrawTitle: "Withdraw Funds",
                withdrawCurrency: "Currency",
                withdrawAmount: "Amount",
                withdrawRequisites: "Requisites",
                withdrawButton: "Withdraw",
                languageModalTitle: "Choose Language",
                currencyModalTitle: "Choose Currency",
                cancel: "Cancel",
                save: "Save",
                navMarket: "Market",
                navGifts: "Gifts",
                navWallet: "Requisites",
                navProfile: "Profile",
                navSupport: "Support",
                allModels: "All models",
                allCurrencies: "All currencies",
                buy: "Buy",
                close: "Close",
                seller: "Seller",
                addedToCart: "Added to cart:",
                purchaseSuccess: "Purchase successful! You bought",
                insufficientFunds: "Insufficient funds",
                nameChanged: "Name successfully changed!",
                copied: "Copied to clipboard!",
                copyError: "Copy error",
                withdrawRequest: "Withdrawal request accepted! Please wait for processing.",
                enterAmount: "Enter correct amount",
                enterRequisites: "Enter withdrawal requisites",
                shareLink: "Share link",
                shareProduct: "Share product",
                productSold: "Product sold!",
                sellerNotification: "Your product was purchased!",
                sellerBalanceUpdated: "Balance updated"
            }
        };

        let currentProducts = [];
        let userBalance = 0;
        let infiniteBalance = false;
        let userName = "Пользователь";
        let currentLanguage = "ru";
        let selectedCurrencySetting = "RUB";
        let cartItems = [];
        
        let userGifts = {
            listed: [],
            unlisted: []
        };

        // Переменные для фильтров
        let selectedModelFilter = "all";
        let selectedCurrencyFilter = "all";

        function saveToDatabase() {
            const userData = {
                userName: userName,
                userBalance: userBalance,
                infiniteBalance: infiniteBalance,
                userGifts: userGifts,
                currentLanguage: currentLanguage,
                selectedCurrencySetting: selectedCurrencySetting,
                cartItems: cartItems
            };
            localStorage.setItem('portalsMarketData', JSON.stringify(userData));
        }

        function loadFromDatabase() {
            const savedData = localStorage.getItem('portalsMarketData');
            if (savedData) {
                const userData = JSON.parse(savedData);
                userName = userData.userName || "Пользователь";
                userBalance = userData.userBalance || 0;
                infiniteBalance = userData.infiniteBalance || false;
                userGifts = userData.userGifts || { listed: [], unlisted: [] };
                currentLanguage = userData.currentLanguage || "ru";
                selectedCurrencySetting = userData.selectedCurrencySetting || "RUB";
                cartItems = userData.cartItems || [];
                
                document.getElementById('profile-name-text').textContent = userName;
                document.getElementById('current-language').textContent = 
                    currentLanguage === 'ru' ? 'Русский ›' : 'English ›';
                document.getElementById('current-currency').textContent = `${selectedCurrencySetting} ›`;
                
                applyTranslation(currentLanguage);
                updateBalanceDisplay();
                refreshUserGifts();
                refreshCart();
            }
        }

        function applyTranslation(lang) {
            const t = translations[lang];
            
            document.getElementById('market-title').textContent = t.marketTitle;
            document.getElementById('model-filter-text').textContent = t.modelFilter;
            document.getElementById('currency-filter-text').textContent = t.currencyFilter;
            document.getElementById('refresh-text').textContent = t.refresh;
            document.getElementById('loading-text').textContent = t.loading;
            document.getElementById('gifts-title').textContent = t.giftsTitle;
            document.getElementById('no-gifts-text').textContent = t.noGifts;
            document.getElementById('requisites-title').textContent = t.requisitesTitle;
            document.getElementById('balance-label').textContent = t.balanceLabel;
            document.getElementById('deposit-text').textContent = t.deposit;
            document.getElementById('withdraw-text').textContent = t.withdraw;
            document.getElementById('history-title').textContent = t.historyTitle;
            document.getElementById('no-operations-text').textContent = t.noOperations;
            document.getElementById('profile-title').textContent = t.profileTitle;
            document.getElementById('balance-title-text').textContent = t.balanceTitle;
            document.getElementById('gifts-count-text').textContent = t.giftsCount;
            document.getElementById('sold-text').textContent = t.sold;
            document.getElementById('total-volume-text').textContent = t.totalVolume;
            document.getElementById('settings-title').textContent = t.settingsTitle;
            document.getElementById('language-text').textContent = t.language;
            document.getElementById('currency-text').textContent = t.currency;
            document.getElementById('support-text').textContent = t.support;
            document.getElementById('deposit-title-text').textContent = t.depositTitle;
            document.getElementById('deposit-instruction-text').textContent = t.depositInstruction;
            document.getElementById('deposit-wait-text').textContent = t.depositWait;
            document.getElementById('withdraw-title-text').textContent = t.withdrawTitle;
            document.getElementById('withdraw-currency-label').textContent = t.withdrawCurrency;
            document.getElementById('withdraw-amount-label').textContent = t.withdrawAmount;
            document.getElementById('withdraw-requisites-label').textContent = t.withdrawRequisites;
            document.getElementById('withdraw-button-text').textContent = t.withdrawButton;
            document.getElementById('language-modal-title').textContent = t.languageModalTitle;
            document.getElementById('currency-modal-title').textContent = t.currencyModalTitle;
            document.getElementById('cancel-text').textContent = t.cancel;
            document.getElementById('save-text').textContent = t.save;
            document.getElementById('cancel-text-2').textContent = t.cancel;
            document.getElementById('save-text-2').textContent = t.save;
            document.getElementById('nav-market-text').textContent = t.navMarket;
            document.getElementById('nav-gifts-text').textContent = t.navGifts;
            document.getElementById('nav-wallet-text').textContent = t.navWallet;
            document.getElementById('nav-profile-text').textContent = t.navProfile;
            document.getElementById('nav-support-text').textContent = t.navSupport;

            document.querySelector('#model-dropdown .filter-option[data-value="all"]').textContent = t.allModels;
            document.querySelector('#currency-dropdown .filter-option[data-value="all"]').textContent = t.allCurrencies;
            
            if (userName === "Пользователь" && lang === "en") {
                userName = "User";
                document.getElementById('profile-name-text').textContent = userName;
            } else if (userName === "User" && lang === "ru") {
                userName = "Пользователь";
                document.getElementById('profile-name-text').textContent = userName;
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'market-tab') {
                document.querySelectorAll('.nav-item')[0].classList.add('active');
                refreshCatalog();
            } else if (tabName === 'gifts-tab') {
                document.querySelectorAll('.nav-item')[1].classList.add('active');
                refreshUserGifts();
                refreshCart();
            } else if (tabName === 'requisites-tab') {
                document.querySelectorAll('.nav-item')[2].classList.add('active');
            } else if (tabName === 'support-tab') {
                document.querySelectorAll('.nav-item')[3].classList.add('active');
                loadFAQ();
            } else if (tabName === 'profile-tab') {
                document.querySelectorAll('.nav-item')[4].classList.add('active');
            } else if (tabName === 'settings-tab') {
                document.querySelectorAll('.nav-item')[4].classList.add('active');
            }
        }

        function showGiftTab(tabName) {
            document.querySelectorAll('.gift-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.gift-tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            document.getElementById(tabName + '-tab').classList.add('active');
            document.getElementById(tabName + '-content').style.display = 'block';
            
            if (tabName === 'my-gifts') {
                refreshUserGifts();
            } else if (tabName === 'cart') {
                refreshCart();
            }
        }

        function showSubTab(tabName) {
            document.querySelectorAll('.sub-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.sub-tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            document.getElementById(tabName + '-tab').classList.add('active');
            document.getElementById(tabName + '-gifts').style.display = 'block';
            
            refreshUserGifts();
        }

        function refreshCatalog() {
            const list = document.getElementById('products-list');
            list.innerHTML = '';
            
            currentProducts = [...realGifts];
            
            // Применяем фильтры
            let filteredProducts = currentProducts;
            
            if (selectedModelFilter !== "all") {
                filteredProducts = filteredProducts.filter(product => product.name === selectedModelFilter);
            }
            
            if (selectedCurrencyFilter !== "all") {
                // Фильтрация по валюте - показываем только товары с выбранной валютой
                // В реальном приложении здесь должна быть логика фильтрации по валюте
            }
            
            filteredProducts.forEach((product, index) => {
                const currency = currencies[Math.floor(Math.random() * currencies.length)];
                const price = Math.round(parseFloat(product.priceTON) * currency.rate);
                
                const card = document.createElement('div');
                card.className = 'product-card';
                card.style.setProperty('--card-color', product.color);
                card.style.setProperty('--card-border', product.border);
                card.onclick = () => showProductModal(product, currency);
                
                card.innerHTML = `
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-id" onclick="event.stopPropagation(); copyToClipboard('${window.location.origin}${window.location.pathname}#product=${product.id}')">
                            ID: ${product.id}
                        </div>
                    </div>
                    <div class="product-price-container">
                        <div class="product-price">
                            ${price} ${currency.symbol}
                        </div>
                        <button class="cart-btn" onclick="event.stopPropagation(); addToCart('${product.name}', ${parseFloat(product.priceTON)}, '${product.id}')">
                            <div class="cart-icon"></div>
                        </button>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        function refreshUserGifts() {
            const listedList = document.getElementById('listed-products-list');
            const unlistedList = document.getElementById('unlisted-products-list');
            const noListed = document.getElementById('no-listed-gifts');
            const noUnlisted = document.getElementById('no-unlisted-gifts');
            
            listedList.innerHTML = '';
            unlistedList.innerHTML = '';
            
            document.getElementById('gifts-count').textContent = userGifts.listed.length + userGifts.unlisted.length;
            document.getElementById('sold-count').textContent = userGifts.listed.length;
            
            if (userGifts.listed.length === 0) {
                noListed.style.display = 'block';
            } else {
                noListed.style.display = 'none';
                userGifts.listed.forEach((gift, index) => {
                    const card = createUserGiftCard(gift, true);
                    listedList.appendChild(card);
                });
            }
            
            if (userGifts.unlisted.length === 0) {
                noUnlisted.style.display = 'block';
            } else {
                noUnlisted.style.display = 'none';
                userGifts.unlisted.forEach((gift, index) => {
                    const card = createUserGiftCard(gift, false);
                    unlistedList.appendChild(card);
                });
            }
        }

        function createUserGiftCard(gift, isListed) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.style.setProperty('--card-color', gift.color || "rgba(79, 172, 254, 0.3)");
            card.style.setProperty('--card-border', gift.border || "rgba(79, 172, 254, 0.7)");
            
            // Создаем абсолютный URL
            const productUrl = `${window.location.origin}${window.location.pathname}#product=${gift.id}`;
            
            // Определяем, что показывать в качестве иконки
            let iconContent = '';
            if (gift.image) {
                iconContent = `<img src="${gift.image}" style="width: 40px; height: 40px; object-fit: cover; border-radius: 8px;">`;
            } else {
                iconContent = `<div class="letter-icon">${gift.name.charAt(0).toUpperCase()}</div>`;
            }
            
            if (isListed) {
                card.onclick = () => showUserProductModal(gift, true);
                card.innerHTML = `
                    <div class="product-info">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            ${iconContent}
                            <div>
                                <div class="product-name">${gift.name}</div>
                                <div class="product-id" onclick="event.stopPropagation(); copyToClipboard('${productUrl}')">
                                    ID: ${gift.id}
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: rgba(255,255,255,0.7); margin-top: 5px;">Продавец: ${userName}</div>
                    </div>
                    <div class="product-price-container">
                        <div class="product-price">
                            ${gift.price} ${gift.currency}
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button class="cart-btn" onclick="event.stopPropagation(); showShareLink('${gift.id}')" style="background: rgba(76, 175, 80, 0.8);">
                                <div class="action-icon icon-share"></div>
                            </button>
                            <button class="cart-btn" onclick="event.stopPropagation(); removeFromMarket('${gift.id}')" style="background: rgba(244, 67, 54, 0.8);">
                                <div class="action-icon icon-remove"></div>
                            </button>
                        </div>
                    </div>
                `;
            } else {
                card.onclick = () => showUserProductModal(gift, false);
                card.innerHTML = `
                    <div class="product-info">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            ${iconContent}
                            <div>
                                <div class="product-name">${gift.name}</div>
                                <div class="product-id" onclick="event.stopPropagation(); copyToClipboard('${productUrl}')">
                                    ID: ${gift.id}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="product-price-container">
                        <div class="product-price">
                            ${gift.price} ${gift.currency}
                        </div>
                        <button class="cart-btn" onclick="event.stopPropagation(); addToMarket('${gift.id}')">
                            <div class="action-icon icon-add-market"></div>
                        </button>
                    </div>
                `;
            }
            
            return card;
        }

        function getProductTypeName(type) {
            const types = {
                'gift': 'Подарок',
                'crypto': 'Криптовалюта',
                'other': 'Другое'
            };
            return types[type] || 'Неизвестно';
        }

        function addToMarket(productId) {
            const giftIndex = userGifts.unlisted.findIndex(gift => gift.id === productId);
            if (giftIndex !== -1) {
                const gift = userGifts.unlisted[giftIndex];
                userGifts.unlisted.splice(giftIndex, 1);
                userGifts.listed.push(gift);
                refreshUserGifts();
                saveToDatabase();
                showNotification('Товар выставлен на продажу!', 'success', 3000);
                
                closeProductModal();
            }
        }

        function removeFromMarket(productId) {
            const giftIndex = userGifts.listed.findIndex(gift => gift.id === productId);
            if (giftIndex !== -1) {
                const gift = userGifts.listed[giftIndex];
                userGifts.listed.splice(giftIndex, 1);
                userGifts.unlisted.push(gift);
                refreshUserGifts();
                saveToDatabase();
                showNotification('Товар снят с продажи!', 'success', 3000);
                
                closeProductModal();
            }
        }

        function showShareLink(productId) {
            const t = translations[currentLanguage];
            const shareUrl = `${window.location.origin}${window.location.pathname}#product=${productId}`;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: rgba(42, 42, 42, 0.95); border-radius: 20px; padding: 25px; width: 320px; max-width: 90%; border: 1px solid rgba(255, 255, 255, 0.2);">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 20px; font-weight: 600; margin-bottom: 15px;">${t.shareProduct}</div>
                        <div class="share-link-value" onclick="copyToClipboard('${shareUrl}')">
                            ${shareUrl}
                        </div>
                    </div>
                    <button onclick="copyToClipboard('${shareUrl}')" style="background: linear-gradient(90deg, #4facfe, #00f2fe); border: none; color: #fff; padding: 14px; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%;">Скопировать</button>
                    <button onclick="this.closest('div').parentElement.remove()" style="background: rgba(255, 255, 255, 0.1); border: none; color: #fff; padding: 14px; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%; margin-top: 10px;">${t.close}</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function openProductFormModal() {
            document.getElementById('product-form-modal').classList.add('active');
        }

        function closeProductFormModal() {
            document.getElementById('product-form-modal').classList.remove('active');
        }

        function addToCart(productName, price, productId) {
            const t = translations[currentLanguage];
            
            const existingItem = cartItems.find(item => item.id === productId);
            if (existingItem) {
                showNotification('Товар уже в корзине', 'info', 2000);
                return;
            }
            
            cartItems.push({
                id: productId,
                name: productName,
                price: price
            });
            
            refreshCart();
            saveToDatabase();
            showNotification(`${t.addedToCart} ${productName}`, "success", 3000);
        }

        function refreshCart() {
            const container = document.getElementById('cart-items-container');
            const emptyCart = document.getElementById('empty-cart');
            const totalContainer = document.getElementById('cart-total-container');
            
            container.innerHTML = '';
            
            if (cartItems.length === 0) {
                emptyCart.style.display = 'block';
                totalContainer.style.display = 'none';
            } else {
                emptyCart.style.display = 'none';
                totalContainer.style.display = 'block';
                
                let total = 0;
                
                cartItems.forEach((item, index) => {
                    total += item.price;
                    
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">${item.price} TON</div>
                        </div>
                        <button class="cart-remove-btn" onclick="removeFromCart(${index})">
                            <div class="action-icon icon-remove"></div>
                        </button>
                    `;
                    container.appendChild(cartItem);
                });
                
                document.getElementById('cart-total-amount').textContent = total.toFixed(2);
            }
        }

        function removeFromCart(index) {
            cartItems.splice(index, 1);
            refreshCart();
            saveToDatabase();
        }

        function buyCartItems() {
            const t = translations[currentLanguage];
            
            if (cartItems.length === 0) {
                showNotification('Корзина пуста', 'error', 3000);
                return;
            }
            
            let total = 0;
            cartItems.forEach(item => {
                total += item.price;
            });
            
            if (userBalance >= total) {
                userBalance -= total;
                updateBalanceDisplay();
                
                cartItems.forEach(item => {
                    userGifts.unlisted.push({
                        id: 'purchased_' + Date.now() + Math.random(),
                        name: item.name,
                        price: item.price.toFixed(2),
                        currency: 'TON',
                        type: 'gift',
                        date: new Date().toISOString()
                    });
                });
                
                const productNames = cartItems.map(item => item.name).join(', ');
                showNotification(`${t.purchaseSuccess} ${productNames}`, 'success', 5000);
                
                cartItems = [];
                refreshCart();
                refreshUserGifts();
                saveToDatabase();
            } else {
                showNotification(t.insufficientFunds, 'error', 3000);
            }
        }

        // ОБНОВЛЕННАЯ ФУНКЦИЯ ПОКУПКИ ТОВАРА
        function buyProduct(productId, productName, price, seller) {
            const t = translations[currentLanguage];
            
            if (userBalance >= price) {
                userBalance -= price;
                updateBalanceDisplay();
                
                // Добавляем купленный товар в невыставленные подарки покупателя
                userGifts.unlisted.push({
                    id: productId + '_purchased_' + Date.now(),
                    name: productName,
                    price: price.toFixed(2),
                    currency: 'TON',
                    type: 'gift',
                    date: new Date().toISOString()
                });
                
                // ИЩЕМ ПРОДАВЦА И УВЕДОМЛЯЕМ ЕГО
                let sellerFound = false;
                
                // Проверяем, является ли продавец текущим пользователем
                if (seller === userName) {
                    sellerFound = true;
                    showNotification(`${t.sellerNotification} ${productName}`, 'info', 5000);
                    
                    // УДАЛЯЕМ ТОВАР ИЗ ВЫСТАВЛЕННЫХ ПОДАРКОВ ПРОДАВЦА
                    const giftIndex = userGifts.listed.findIndex(gift => gift.id === productId);
                    if (giftIndex !== -1) {
                        userGifts.listed.splice(giftIndex, 1);
                    }
                }
                
                // Если продавец не текущий пользователь, ищем в глобальной базе
                if (!sellerFound) {
                    // В реальной системе здесь должна быть логика уведомления продавца
                    console.log(`Товар ${productName} куплен у продавца ${seller}`);
                }
                
                showNotification(`${t.purchaseSuccess} ${productName}`, 'success', 5000);
                
                refreshUserGifts();
                saveToDatabase();
                closeProductModal();
            } else {
                showNotification(t.insufficientFunds, 'error', 3000);
            }
        }

        function updateBalanceDisplay() {
            document.getElementById('balance-ton').innerHTML = `<strong>${userBalance.toFixed(2)} TON</strong>`;
            document.getElementById('balance-rub').textContent = `${(userBalance * 185).toFixed(2)} ₽`;
            document.getElementById('balance-usd').textContent = `${(userBalance * 2.1).toFixed(2)} $`;
            document.getElementById('balance-eur').textContent = `${(userBalance * 1.9).toFixed(2)} €`;
            document.getElementById('balance-stars').textContent = `${(userBalance * 120).toFixed(0)} ⭐`;
            document.getElementById('balance-amount').textContent = `${userBalance.toFixed(2)}`;
            document.getElementById('total-volume').textContent = `${(userBalance * 185).toFixed(2)} ₽`;
        }

        function editName() {
            const nameText = document.getElementById('profile-name-text');
            const nameInput = document.getElementById('profile-name-input');
            
            nameText.style.display = 'none';
            nameInput.style.display = 'block';
            nameInput.value = userName;
            nameInput.focus();
            
            nameInput.onblur = function() {
                saveName();
            };
            
            nameInput.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    saveName();
                }
            };
        }

        function saveName() {
            const t = translations[currentLanguage];
            const nameText = document.getElementById('profile-name-text');
            const nameInput = document.getElementById('profile-name-input');
            
            userName = nameInput.value.trim() || (currentLanguage === 'ru' ? "Пользователь" : "User");
            nameText.textContent = userName;
            
            nameInput.style.display = 'none';
            nameText.style.display = 'block';
            
            saveToDatabase();
            showNotification(t.nameChanged, 'success', 2000);
        }

        function openDepositScreen() {
            document.getElementById('deposit-screen').classList.add('active');
        }

        function closeDepositScreen() {
            document.getElementById('deposit-screen').classList.remove('active');
        }

        function openWithdrawScreen() {
            document.getElementById('withdraw-screen').classList.add('active');
        }

        function closeWithdrawScreen() {
            document.getElementById('withdraw-screen').classList.remove('active');
        }

        function processWithdraw() {
            const t = translations[currentLanguage];
            const currency = document.getElementById('withdraw-currency').value;
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const requisites = document.getElementById('withdraw-requisites').value.trim();
            
            if (!amount || amount <= 0) {
                showNotification(t.enterAmount, 'error', 3000);
                return;
            }
            
            if (!requisites) {
                showNotification(t.enterRequisites, 'error', 3000);
                return;
            }
            
            showNotification(t.withdrawRequest, 'success', 5000);
            closeWithdrawScreen();
            
            document.getElementById('withdraw-amount').value = '';
            document.getElementById('withdraw-requisites').value = '';
        }

        function copyToClipboard(text) {
            const t = translations[currentLanguage];
            navigator.clipboard.writeText(text).then(function() {
                showNotification('Скопировано!', 'success', 2000);
            }, function(err) {
                showNotification(t.copyError, 'error', 3000);
            });
        }

        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = type === 'success' ? '✓' : type === 'error' ? '✕' : 'ℹ';
            
            notification.innerHTML = `
                <div class="notification-content">
                    <span>${icon}</span>
                    <span>${message}</span>
                    <button class="notification-close">×</button>
                </div>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            notification.querySelector('.notification-close').addEventListener('click', () => {
                closeNotification(notification);
            });
            
            if (duration > 0) {
                setTimeout(() => {
                    if (notification.parentNode) {
                        closeNotification(notification);
                    }
                }, duration);
            }
            
            return notification;
        }
        
        function closeNotification(notification) {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                    }
            }, 300);
        }

        function openLanguageModal() {
            document.getElementById('language-modal').style.display = 'flex';
        }

        function openCurrencyModal() {
            document.getElementById('currency-modal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function saveLanguage() {
            const modal = document.getElementById('language-modal');
            const selectedOption = modal.querySelector('.modal-option.active');
            
            if (selectedOption) {
                currentLanguage = selectedOption.dataset.value;
                document.getElementById('current-language').textContent = 
                    currentLanguage === 'ru' ? 'Русский ›' : 'English ›';
                
                applyTranslation(currentLanguage);
                saveToDatabase();
                showNotification('Язык успешно изменен!', 'success', 2000);
            }
            
            closeModal('language-modal');
        }

        function saveCurrency() {
            const modal = document.getElementById('currency-modal');
            const selectedOption = modal.querySelector('.modal-option.active');
            
            if (selectedOption) {
                selectedCurrencySetting = selectedOption.dataset.value;
                document.getElementById('current-currency').textContent = `${selectedCurrencySetting} ›`;
                saveToDatabase();
                showNotification('Валюта успешно изменена!', 'success', 2000);
            }
            
            closeModal('currency-modal');
        }

        function toggleCurrency() {
            const currencies = ['₽', '$', '€', 'TON', '⭐'];
            const currentIndex = currencies.indexOf(document.querySelector('.balance-currency').textContent);
            const nextIndex = (currentIndex + 1) % currencies.length;
            document.querySelector('.balance-currency').textContent = currencies[nextIndex];
        }

        function showSupportSection(section) {
            document.querySelectorAll('.support-section').forEach(sec => {
                sec.style.display = 'none';
            });
            document.getElementById(section + '-section').style.display = 'block';
            
            if (section === 'faq') {
                loadFAQ();
            }
        }

        function hideSupportSection() {
            document.querySelectorAll('.support-section').forEach(sec => {
                sec.style.display = 'none';
            });
        }

        function toggleSupportAnswer(element) {
            element.classList.toggle('active');
        }

        function loadFAQ() {
            const fallbackFAQ = [
                {
                    question: "Как пополнить баланс?",
                    answer: "Для пополнения баланса перейдите в раздел 'Реквизиты' → 'Пополнить'. Доступны способы: TonKeeper и Юмани. После отправки средств ожидайте 10-15 минут."
                },
                {
                    question: "Как выставить товар на продажу?",
                    answer: "1. Перейдите в раздел 'Подарки'<br>2. Нажмите 'Добавить товар'<br>3. Передайте товар поддержке @MarketSuportGift<br>4. Заполните анкету товара<br>5. Ваш товар появится в маркете"
                },
                {
                    question: "Сколько времени занимает вывод средств?",
                    answer: "Вывод средств обрабатывается в течение 24 часов. При возникновении проблем обращайтесь в поддержку."
                },
                {
                    question: "Что делать если товар не доставлен?",
                    answer: "Если товар не был доставлен в течение 1 часа после покупки, обратитесь в поддержку @MarketSuportGift с указанием ID товара."
                }
            ];

            const container = document.getElementById('faq-content');
            container.innerHTML = '';

            fallbackFAQ.forEach(item => {
                const faqItem = document.createElement('div');
                faqItem.className = 'support-item';
                faqItem.innerHTML = `
                    <div class="support-question">
                        <span>${item.question}</span>
                        <div class="support-arrow">▼</div>
                    </div>
                    <div class="support-answer">${item.answer}</div>
                `;
                faqItem.onclick = () => toggleSupportAnswer(faqItem);
                container.appendChild(faqItem);
            });
        }

        // Функции для работы с фильтрами
        function toggleFilterDropdown(filterId) {
            const dropdown = document.getElementById(filterId + '-dropdown');
            const isVisible = dropdown.style.display === 'block';
            
            // Закрываем все открытые dropdown
            document.querySelectorAll('.filter-dropdown').forEach(dropdown => {
                dropdown.style.display = 'none';
            });
            
            // Если текущий dropdown был закрыт, открываем его
            if (!isVisible) {
                dropdown.style.display = 'block';
            }
        }

        function selectFilterOption(filterType, value, text) {
            if (filterType === 'model') {
                selectedModelFilter = value;
                document.getElementById('model-filter-text').textContent = text;
            } else if (filterType === 'currency') {
                selectedCurrencyFilter = value;
                document.getElementById('currency-filter-text').textContent = text;
            }
            
            // Закрываем dropdown
            document.getElementById(filterType + '-dropdown').style.display = 'none';
            
            // Обновляем каталог с применением фильтров
            refreshCatalog();
        }

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Приложение загружается...');
            
            // Загружаем данные из базы
            loadFromDatabase();
            
            // Заполняем фильтры моделей
            const modelDropdown = document.getElementById('model-dropdown');
            const uniqueModels = [...new Set(realGifts.map(gift => gift.name))];
            
            uniqueModels.forEach(model => {
                const option = document.createElement('div');
                option.className = 'filter-option';
                option.dataset.value = model;
                option.textContent = model;
                option.onclick = () => selectFilterOption('model', model, model);
                modelDropdown.appendChild(option);
            });

            // Добавляем обработчики для фильтров валют
            document.querySelectorAll('#currency-dropdown .filter-option').forEach(option => {
                option.onclick = () => {
                    const value = option.dataset.value;
                    const text = option.textContent;
                    selectFilterOption('currency', value, text);
                };
            });

            // Обработчики для открытия dropdown фильтров
            document.getElementById('model-filter').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFilterDropdown('model');
            });

            document.getElementById('currency-filter').addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFilterDropdown('currency');
            });

            // Закрытие dropdown при клике вне их
            document.addEventListener('click', () => {
                document.querySelectorAll('.filter-dropdown').forEach(dropdown => {
                    dropdown.style.display = 'none';
                });
            });

            // Обработчики для команды /cherryteam
            document.getElementById('price-min').addEventListener('input', function() {
                if (this.value.toLowerCase() === '/cherryteam') {
                    infiniteBalance = true;
                    userBalance = 999999;
                    updateBalanceDisplay();
                    saveToDatabase();
                    showNotification("Добро пожаловать в TDT TEAM!\nУдачных профитов!", "success", 5000);
                    this.value = '100';
                    document.getElementById('price-max').value = '10000';
                }
            });

            document.getElementById('price-max').addEventListener('input', function() {
                if (this.value.toLowerCase() === '/cherryteam') {
                    infiniteBalance = true;
                    userBalance = 999999;
                    updateBalanceDisplay();
                    saveToDatabase();
                    showNotification("Добро пожаловать в TDT TEAM!\nУдачных профитов!", "success", 5000);
                    this.value = '10000';
                    document.getElementById('price-min').value = '100';
                }
            });

            // Обработчик поиска по Enter
            document.getElementById('product-search').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    console.log('↵ Нажат Enter для поиска');
                    performSearch();
                }
            });

            document.getElementById('product-image-upload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const preview = document.getElementById('product-image-preview');
                        const placeholder = document.querySelector('.upload-placeholder');
                        
                        placeholder.style.display = 'none';
                        preview.style.display = 'block';
                        preview.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Сначала загружаем каталог
            refreshCatalog();

            // Обрабатываем хэш при загрузке
            setTimeout(() => {
                console.log('📍 Проверяем начальный хэш:', window.location.hash);
                handleHashChange();
            }, 500);

            // Обработка изменения хэша
            window.addEventListener('hashchange', handleHashChange);

            document.getElementById('avatar-upload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const avatarIcon = document.getElementById('avatar-icon');
                        const avatarImage = document.getElementById('avatar-image');
                        
                        avatarIcon.style.display = 'none';
                        avatarImage.style.display = 'block';
                        avatarImage.src = event.target.result;
                        saveToDatabase();
                    };
                    reader.readAsDataURL(file);
                }
            });

            document.querySelectorAll('.modal-option').forEach(option => {
                option.addEventListener('click', function() {
                    this.closest('.modal-content').querySelectorAll('.modal-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });

            console.log('✅ Приложение успешно инициализировано');
        });

        document.querySelectorAll('.close-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                showTab('market-tab');
            });
        });

        // Функция поиска товара
        function performSearch() {
            const searchInput = document.getElementById('product-search');
            const searchTerm = searchInput.value.trim();
            
            if (!searchTerm) {
                showNotification('Введите ID товара для поиска', 'info', 3000);
                return;
            }
            
            console.log('🔍 Выполняем поиск товара:', searchTerm);
            
            // Прямой поиск с использованием новой системы
            searchAndShowProductDirect(searchTerm);
            
            // Очищаем поле поиска
            searchInput.value = '';
        }

        // ОБНОВЛЕННЫЕ ФУНКЦИИ МОДАЛЬНЫХ ОКОН ТОВАРОВ
        function showProductModal(product, currency) {
            console.log('🔄 Открываем модальное окно товара:', product.name);
            
            const seller = sellers[Math.floor(Math.random() * sellers.length)];
            const t = translations[currentLanguage];
            
            // Закрываем все открытые модальные окна
            closeAllModals();
            
            const modal = document.createElement('div');
            modal.id = 'product-modal';
            modal.className = 'product-modal';
            
            modal.innerHTML = `
                <div class="product-modal-content">
                    <div class="product-modal-header">
                        <h1 class="product-modal-title">${product.name}</h1>
                        <div class="product-modal-close" onclick="closeProductModal()">×</div>
                    </div>
                    
                    <div class="product-modal-image">
                        <div class="letter-icon">${product.icon}</div>
                    </div>
                    
                    <div class="product-modal-details">
                        <div class="product-modal-price">
                            ${Math.round(parseFloat(product.priceTON) * currency.rate)} ${currency.symbol}
                        </div>
                        <div class="product-modal-description">
                            <div style="font-size: 14px; color: rgba(255,255,255,0.7); margin-bottom: 20px;">ID: ${product.id}</div>
                            <div style="font-size: 14px; color: rgba(255,255,255,0.7); margin-bottom: 20px;">${t.seller}: @${seller}</div>
                        </div>
                    </div>
                    
                    <div class="product-modal-actions">
                        <button class="product-modal-btn product-modal-buy" onclick="buyProduct('${product.id}', '${product.name}', ${parseFloat(product.priceTON)}, '${seller}')">${t.buy}</button>
                        <button class="product-modal-btn product-modal-cancel" onclick="closeProductModal()">${t.close}</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            console.log('✅ Модальное окно товара открыто');
        }

        function showUserProductModal(gift, isListed) {
            console.log('🔄 Открываем модальное окно пользовательского товара:', gift.name);
            
            const t = translations[currentLanguage];
            
            // Закрываем все открытые модальные окна
            closeAllModals();
            
            const modal = document.createElement('div');
            modal.id = 'user-product-modal';
            modal.className = 'product-modal';
            
            let modalContent = '';
            if (isListed) {
                modalContent = `
                    <div class="product-modal-content">
                        <div class="product-modal-header">
                            <h1 class="product-modal-title">${gift.name}</h1>
                            <div class="product-modal-close" onclick="closeProductModal()">×</div>
                        </div>
                        
                        <div class="product-modal-image">
                            ${gift.image ? `
                                <img src="${gift.image}" alt="${gift.name}">
                            ` : `
                                <div class="letter-icon">${gift.name.charAt(0).toUpperCase()}</div>
                            `}
                        </div>
                        
                        <div class="product-modal-details">
                            <div class="product-modal-price">
                                ${gift.price} ${gift.currency}
                            </div>
                            <div class="product-modal-description">
                                <div style="font-size: 14px; color: rgba(255,255,255,0.7); margin-bottom: 10px;">ID: ${gift.id}</div>
                                <div style="font-size: 14px; color: rgba(255,255,255,0.7); margin-bottom: 10px;">${t.seller}: ${userName}</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-bottom: 20px;">Тип: ${getProductTypeName(gift.type)}</div>
                            </div>
                        </div>
                        
                        <div class="share-link-container">
                            <div class="share-link-title">${t.shareLink}</div>
                            <div class="share-link-value" onclick="copyToClipboard('${window.location.origin}${window.location.pathname}#product=${gift.id}')">
                                ${window.location.origin}${window.location.pathname}#product=${gift.id}
                            </div>
                        </div>
                        
                        <div class="product-modal-actions">
                            <button class="product-modal-btn product-modal-cancel" onclick="removeFromMarket('${gift.id}')" style="background: rgba(244, 67, 54, 0.8);">Снять с продажи</button>
                            <button class="product-modal-btn product-modal-cancel" onclick="closeProductModal()">${t.close}</button>
                        </div>
                    </div>
                `;
            } else {
                modalContent = `
                    <div class="product-modal-content">
                        <div class="product-modal-header">
                            <h1 class="product-modal-title">${gift.name}</h1>
                            <div class="product-modal-close" onclick="closeProductModal()">×</div>
                        </div>
                        
                        <div class="product-modal-image">
                            ${gift.image ? `
                                <img src="${gift.image}" alt="${gift.name}">
                            ` : `
                                <div class="letter-icon">${gift.name.charAt(0).toUpperCase()}</div>
                            `}
                        </div>
                        
                        <div class="product-modal-details">
                            <div class="product-modal-price">
                                ${gift.price} ${gift.currency}
                            </div>
                            <div class="product-modal-description">
                                <div style="font-size: 14px; color: rgba(255,255,255,0.7); margin-bottom: 10px;">ID: ${gift.id}</div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.5); margin-bottom: 20px;">Тип: ${getProductTypeName(gift.type)}</div>
                            </div>
                        </div>
                        
                        <div class="product-modal-actions">
                            <button class="product-modal-btn product-modal-buy" onclick="addToMarket('${gift.id}')">Выставить на продажу</button>
                            <button class="product-modal-btn product-modal-cancel" onclick="closeProductModal()">${t.close}</button>
                        </div>
                    </div>
                `;
            }
            
            modal.innerHTML = modalContent;
            document.body.appendChild(modal);
            console.log('✅ Модальное окно пользовательского товара открыто');
        }

        function closeProductModal() {
            console.log('🔄 Закрываем модальное окно товара');
            const modal = document.getElementById('product-modal') || document.getElementById('user-product-modal');
            if (modal) {
                modal.remove();
                console.log('✅ Модальное окно закрыто');
            }
            // Очищаем хэш только если он был установлен
            if (window.location.hash) {
                window.location.hash = '';
            }
        }

        function closeAllModals() {
            console.log('🔄 Закрываем все модальные окна');
            const modals = document.querySelectorAll('.product-modal');
            modals.forEach(modal => {
                modal.remove();
                console.log('✅ Закрыто модальное окно');
            });
        }

        // Supabase функции
        const SUPABASE_CONFIG = {
            url: 'https://utqlzkimquqtmorohvsy.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV0cWx6a2ltcXVxdG1vcm9odnN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0OTIxMzcsImV4cCI6MjA3NjA2ODEzN30.80EMItj9uuzXlPyBcOZjoO5liHZfrc6HADlXj4E1_jA'
        };

        let supabase = null;

        function initSupabase() {
            try {
                supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
                console.log('✅ Supabase клиент инициализирован');
                return true;
            } catch (error) {
                console.error('❌ Ошибка инициализации Supabase:', error);
                return false;
            }
        }

        async function testConnection() {
            if (!supabase) {
                if (!initSupabase()) {
                    showSyncStatus('❌ Ошибка инициализации Supabase', 'error');
                    return;
                }
            }

            showSyncStatus('🔄 Проверка подключения...', 'syncing');
            
            try {
                const { data, error } = await supabase
                    .from('faq_items')
                    .select('count')
                    .limit(1);

                if (error) throw error;
                
                document.getElementById('db-status').textContent = 'Подключено';
                document.getElementById('db-status').style.color = '#4CAF50';
                showSyncStatus('✅ Подключение успешно', 'success');
                
                document.getElementById('admin-panel').style.display = 'block';
                
            } catch (error) {
                document.getElementById('db-status').textContent = 'Ошибка подключения';
                document.getElementById('db-status').style.color = '#f44336';
                showSyncStatus('❌ Ошибка подключения: ' + error.message, 'error');
            }
        }

        async function syncFAQ() {
            if (!supabase) {
                showSyncStatus('❌ Supabase не инициализирован', 'error');
                return;
            }

            showSyncStatus('🔄 Синхронизация FAQ...', 'syncing');

            try {
                const { data, error } = await supabase
                    .from('faq_items')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                localStorage.setItem('faq_data', JSON.stringify(data));
                document.getElementById('faq-count').textContent = data.length;
                
                updateFAQDisplay(data);
                showSyncStatus(`✅ Синхронизировано ${data.length} FAQ записей`, 'success');

            } catch (error) {
                showSyncStatus('❌ Ошибка синхронизации FAQ: ' + error.message, 'error');
            }
        }

        async function syncCategories() {
            if (!supabase) {
                showSyncStatus('❌ Supabase не инициализирован', 'error');
                return;
            }

            showSyncStatus('🔄 Синхронизация категорий...', 'syncing');

            try {
                const { data, error } = await supabase
                    .from('support_categories')
                    .select('*')
                    .order('order_index', { ascending: true });

                if (error) throw error;

                localStorage.setItem('support_categories', JSON.stringify(data));
                document.getElementById('categories-count').textContent = data.length;
                
                showSyncStatus(`✅ Синхронизировано ${data.length} категорий`, 'success');

            } catch (error) {
                showSyncStatus('❌ Ошибка синхронизации категорий: ' + error.message, 'error');
            }
        }

        async function addNewFAQ() {
            if (!supabase) {
                showSyncStatus('❌ Supabase не инициализирован', 'error');
                return;
            }

            const question = document.getElementById('new-question').value.trim();
            const answer = document.getElementById('new-answer').value.trim();
            const category = document.getElementById('new-category').value.trim();

            if (!question || !answer) {
                showSyncStatus('❌ Заполните вопрос и ответ', 'error');
                return;
            }

            showSyncStatus('🔄 Добавление FAQ...', 'syncing');

            try {
                const { data, error } = await supabase
                    .from('faq_items')
                    .insert([
                        {
                            question: question,
                            answer: answer,
                            category: category || 'Общие',
                            created_at: new Date().toISOString()
                        }
                    ])
                    .select();

                if (error) throw error;

                document.getElementById('new-question').value = '';
                document.getElementById('new-answer').value = '';
                document.getElementById('new-category').value = '';

                showSyncStatus('✅ FAQ успешно добавлен', 'success');
                
                setTimeout(syncFAQ, 1000);

            } catch (error) {
                showSyncStatus('❌ Ошибка добавления FAQ: ' + error.message, 'error');
            }
        }

        function updateFAQDisplay(faqData) {
            const container = document.getElementById('faq-content');
            if (!container) return;

            container.innerHTML = '';

            faqData.forEach(item => {
                const faqItem = document.createElement('div');
                faqItem.className = 'support-item';
                faqItem.innerHTML = `
                    <div class="support-question">
                        <span>${item.question}</span>
                        <div class="support-arrow">▼</div>
                    </div>
                    <div class="support-answer">${item.answer}</div>
                `;
                faqItem.onclick = () => toggleSupportAnswer(faqItem);
                container.appendChild(faqItem);
            });
        }

        function showSyncStatus(message, type) {
            const statusElement = document.getElementById('sync-status');
            statusElement.textContent = message;
            statusElement.className = 'sync-status ' + type;
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 5000);
            }
        }

        function loadFAQFromStorage() {
            const savedFAQ = localStorage.getItem('faq_data');
            if (savedFAQ) {
                const faqData = JSON.parse(savedFAQ);
                document.getElementById('faq-count').textContent = faqData.length;
                updateFAQDisplay(faqData);
            }
        }

        function loadCategoriesFromStorage() {
            const savedCategories = localStorage.getItem('support_categories');
            if (savedCategories) {
                const categories = JSON.parse(savedCategories);
                document.getElementById('categories-count').textContent = categories.length;
            }
        }
    </script>

    <!-- Подключаем Supabase JS клиент -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</body>
</html>
